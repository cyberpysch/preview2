<div class="card shadow-sm border-0">
    <div class="card-header d-flex justify-content-between align-items-center bg-dark text-white py-2"
        style="font-size: 0.85rem; max-width: 1500px;">
        <h6 class="mb-0 text-uppercase">{{ target_role }} Details</h6>
        <button class="btn btn-primary btn-sm px-3" onclick="location.reload()">Back</button>
    </div>

    <div class="p-3 bg-white">
        <div class="mb-3">
            <button class="btn btn-primary btn-sm px-4"
                onclick="handleCreateClick('{{ target_role }}', {{ my_level|default:0 }}, {{ target_level|default:0 }})">
                + Create
            </button>
        </div>

        <div class="modal fade" id="uplineModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header bg-dark text-white py-2">
                        <h6 class="modal-title">Select Upline</h6>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body p-4">
                        <select class="form-select" id="parentSelect">
                            <option selected disabled>Select Parent</option>
                        </select>
                        <div class="text-center mt-3">
                            <button class="btn btn-primary btn-sm px-5" onclick="proceedToRegistration()">Next</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--  ADDED DEPOSIT MODAL  -->
        <div class="modal fade" id="depositModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">

                    <div class="modal-header bg-dark text-white py-2">
                        <h6 class="modal-title">Deposit Coins</h6>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>

                    <div class="modal-body p-4">
                        {% csrf_token %}

                        <input type="hidden" id="depositUsername">

                        <div class="mb-3">
                            <label class="form-label">Amount</label>
                            <input type="number" id="depositAmount" class="form-control" min="1"
                                placeholder="Enter coins">
                        </div>

                        <div class="text-center">
                            <button class="btn btn-primary btn-sm px-5" onclick="submitDeposit()">
                                Submit
                            </button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <!-- ‚úÖ END DEPOSIT MODAL -->
        <!--Withdraw modal-->
        <div class="modal fade" id="withdrawModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">

                    <div class="modal-header">
                        <h5 class="modal-title">Withdraw Coins</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>

                    <div class="modal-body">
                        <input type="hidden" id="withdrawUsername">

                        <div class="mb-3">
                            <label class="form-label">Amount</label>
                            <input type="number" id="withdrawAmount" class="form-control" min="1">
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" onclick="submitWithdraw()">
                            Confirm Withdraw
                        </button>
                    </div>

                </div>
            </div>
        </div>
        <!--End withdraw modal-->
        <div class="table-responsive">
            <div class="bg-dark border border-bottom-0 p-2">
                <button type="button" class="btn btn-primary btn-sm me-2 filter-active" >
                    Active
                </button>
                <button type="button" class="btn btn-danger btn-sm filter-inactive" >
                    Inactive
                </button>
            </div>
            <table id="usersTable" class="table table-bordered table-sm text-center align-middle"
                style="font-size: 0.85rem; max-width: 1500px;">
                <thead class="table-dark">
                    <tr>
                        <th rowspan="2" class="align-middle">#</th>
                        <th rowspan="2" class="align-middle">Action</th>
                        <th rowspan="2" class="align-middle">User</th>
                        <!--<th rowspan="2" class="align-middle">Name</th>-->
                        <th rowspan="2" class="align-middle">Upline Reporting</th>
                        <!--  <th rowspan="2" class="align-middle">Password</th>-->
                        <th rowspan="2" class="align-middle">Share</th>
                        <th colspan="3">Agent Comm %</th>

                    </tr>
                    <tr>
                        <th>Match</th>
                        <th>Sess</th>
                        <th>Casino</th>
                        <th>Coins</th>
                    </tr>
                </thead>
                <tbody>
                    {% for acc in accounts %}
                    <tr data-active="{{ acc.user.is_active|yesno:'true,false' }}">
                        <td>{{ forloop.counter }}</td>
                        <td>
                            <div class="dropdown">
                                <button class="btn btn-info btn-sm py-0 px-2" type="button" data-bs-toggle="dropdown"
                                    aria-expanded="false">
                                    <small>‚ñº</small>
                                </button>
                                <ul class="dropdown-menu shadow">
                                    <li>
                                        <a class="dropdown-item" href="javascript:void(0);"
                                            onclick="handleDepositClick('{{ acc.user.username }}'); return false;">
                                            Deposit
                                        </a>
                                    </li>

                                    <li>
                                        <a class="dropdown-item" href="javascript:void(0);"
                                            onclick="handleWithdrawClick('{{ acc.user.username }}'); return false;">
                                            Withdraw
                                        </a>
                                    </li>

                                    <li><a class="dropdown-item"
                                            href="/accounts/exposure/{{ acc.user.username }}/">Exposure Limit</a></li>
                                    <li><a class="dropdown-item text-danger"
                                            href="/accounts/status/{{ acc.user.username }}/">Inactive/Active</a>
                                    </li>
                                    <li><a class="dropdown-item text-danger"
                                            href="/accounts/status/{{ acc.user.username }}/">Block Market</a>
                                    </li>
                                    <li>
                                        <hr class="dropdown-divider">
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="#"
                                            onclick="handleEditClick('{{ acc.user.username }}', '{{ target_role }}')">
                                            Edit
                                        </a>
                                    </li>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="javascript:void(0);"
                                            onclick="handleStatementClick('{{ acc.user.username }}'); return false;">
                                            Statement
                                        </a>
                                    </li>

                                    <li><a class="dropdown-item"
                                            href="{% url 'account_operations' acc.user.username %}">Account Operations</a>
                                    </li>
                                    <li><a class="dropdown-item"
                                            href="/accounts/login-report/{{ acc.user.username }}/">Login Report</a></li>
                                    <li><a class="dropdown-item"
                                            href="/accounts/reset-password/{{ acc.user.username }}/">Reset Password</a>
                                    </li>
                                </ul>
                            </div>
                        </td>
                        <td class="text-primary fw-bold">
                            <span style="cursor:pointer;">üëÅ {{ acc.user.username }}</span>
                        </td>
                        <!--<td>{{ acc.user.first_name|default:"-" }}</td>-->
                        <td>{{ acc.parent.user.username|default:"System" }}</td>
                        <!--<td>
                            ***** <a href="https://wa.me/{{ acc.user.phone_number }}" class="text-success ms-1">
                                <i class="fab fa-whatsapp"></i>
                            </a>
                        </td>-->
                        <td>{{ acc.match_share }}%</td>
                        <td>{{ acc.match_commission }}</td>
                        <td>{{ acc.session_commission }}</td>
                        <td>{{ acc.casino_commission }}</td>

                        <td class="fw-bold text-success">{{ acc.coins }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="12" class="py-5 text-muted bg-light">
                            No records found for {{ target_role }}.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>